ì£¼ê¸°ì ìœ¼ë¡œ ì‘ë™í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•˜ë©° ë§¤ë²ˆ ë²„ê·¸ë¥¼ ìˆ˜ì •í•˜ëŠ” ê²ƒì„ ë°˜ë³µí•˜ë‹¤ë³´ë‹ˆ, í…ŒìŠ¤íŠ¸ ì½”ë“œì˜ í•„ìš”ì„±ì„ ì ˆì‹¤íˆ ëŠë¼ê²Œ ë˜ì—ˆë‹¤. [í•´ë‹¹ ë¬¸ì„œ](https://r-pkgs.org/tests.html)ë¥¼ ë²ˆì—­/ì •ë¦¬í•˜ë©° `testthat` íŒ¨í‚¤ì§€ë¥¼ ì´ìš©í•´ unit testë¥¼ í•˜ëŠ” ë°©ë²•ì„ ìµíˆê³  ì—…ë¬´ì— ì ìš©í•´ë³´ê³ ì í•œë‹¤.

## The goal of testing
> I started using automated tests because I discovered I was spending too much time re-fixing bugs that Iâ€™d already fixed before.

ê¶ê·¹ì ì¸ ëª©ì ì€ ê²°êµ­ ì‹œê°„ì„ ì•„ë¼ê¸° ìœ„í•¨ì´ë‹¤. ì¶”ê°€ì ìœ¼ë¡œ ì•„ë˜ì™€ ê°™ì€ ì´ì ì„ ëˆ„ë¦´ ìˆ˜ ìˆë‹¤.

- **ë²„ê·¸ê°€ ì ì–´ì§„ë‹¤.** ì½”ë“œê°€ ì–´ë–»ê²Œ ì‘ë™í•´ì•¼ë§Œ í•˜ëŠ”ì§€ ì´ì¤‘ìœ¼ë¡œ ëª…ì‹œí•˜ê¸° ë•Œë¬¸ì´ë‹¤.(ì‹¤ì œ ì½”ë“œì™€ í…ŒìŠ¤íŠ¸ ì½”ë“œ)
- **ì½”ë“œ êµ¬ì¡°ê°€ ë” ë‚˜ì•„ì§„ë‹¤.** ë” ì˜ ë””ìì¸ëœ ì½”ë“œì¼ ìˆ˜ë¡ í…ŒìŠ¤íŠ¸í•˜ê¸°ë„ ì‰¬ìš´ ë²•ì´ë‹¤. ì½”ë“œë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ì„ , ì–´ì©” ìˆ˜ ì—†ì´ ì½”ë“œì—ì„œ ë³µì¡í•œ ë¶€ë¶„ë“¤ì„ ê°ê° ì‘ë™í•˜ëŠ” ì—¬ëŸ¬ê°œì˜ í•¨ìˆ˜ë“¤ë¡œ ë¶„ë¦¬í•´ì•¼ë§Œ í•œë‹¤. ì½”ë“œì˜ ì¤‘ë³µì´ ì¤„ì–´ë“¤ê¸°ì—, í•¨ìˆ˜ë“¤ì€ í…ŒìŠ¤íŠ¸í•˜ê³ , ì´í•´í•˜ê³ , ì‚¬ìš©í•˜ê¸° í¸í•´ì§„ë‹¤.
- **ì¬ì‹œì‘í•˜ê¸° ì‰¬ì›Œì§„ë‹¤.**(ì´ ë¶€ë¶„ì€ ë¬´ìŠ¨ ë§ì¸ì§€ ì˜ ì´í•´ê°€ ì•ˆëœë‹¤.) failing í…ŒìŠ¤íŠ¸ë¡œ ì½”ë”©ì„ ë§ˆë¬´ë¦¬í•œë‹¤ë©´, ë‹¤ìŒì— ë‹¤ì‹œ ì‹œì‘í•  ë•Œ í…ŒìŠ¤íŠ¸ê°€ ë¬´ì—‡ì„ í•´ì•¼í• ì§€ ì˜ ì•Œë ¤ì¤„ ê²ƒì´ë‹¤.
- **ì½”ë“œê°€ Robustí•´ì§„ë‹¤.** ì‘ì„±í•œ ì½”ë“œì˜ ì£¼ìš” ê¸°ëŠ¥ë“¤ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ê°€ ê°–ì¶°ì ¸ ìˆìŒì„ ì¸ì§€í•œë‹¤ë©´, í° ë‘ë ¤ì›€ ì—†ì´ í° ë³€í™”ë¥¼ ì‹œë„í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

## Test structure
í…ŒìŠ¤íŠ¸ íŒŒì¼ì€ `test/testthat/` ë””ë ‰í† ë¦¬ ì•ˆì—, `test`ë¡œ ì‹œì‘í•˜ëŠ” ì´ë¦„ìœ¼ë¡œ ìƒì„±í•´ì•¼ í•œë‹¤. ë‹¤ìŒì€ `stringr` íŒ¨í‚¤ì§€ í…ŒìŠ¤íŠ¸ íŒŒì¼ì˜ ì˜ˆì‹œì´ë‹¤.
```r
context("String length")
library(stringr)

test_that("str_length is number of characters", {
  expect_equal(str_length("a"), 1)
  expect_equal(str_length("ab"), 2)
  expect_equal(str_length("abc"), 3)
})
#> Test passed ğŸ˜€

test_that("str_length of factor is length of level", {
  expect_equal(str_length(factor("a")), 1)
  expect_equal(str_length(factor("ab")), 2)
  expect_equal(str_length(factor("abc")), 3)
})
#> Test passed ğŸ‰

test_that("str_length of missing is missing", {
  expect_equal(str_length(NA), NA_integer_)
  expect_equal(str_length(c(NA, 1)), c(NA, 1))
  expect_equal(str_length("NA"), 2)
})
#> Test passed ğŸ¥‡
```

í…ŒìŠ¤íŠ¸ëŠ” `files > tests > expectations`ì˜ ê³„ì¸µì  êµ¬ì¡°ë¡œ ì´ë£¨ì–´ì ¸ ìˆë‹¤.

- **expectation**ì€ í…ŒìŠ¤íŠ¸ì˜ ê°€ì¥ ê¸°ë³¸ì ì¸ ë‹¨ìœ„ì´ë‹¤. ì˜¬ë°”ë¥¸ ê°’ê³¼ í´ë˜ìŠ¤ë¥¼ ë°˜í™˜í–ˆëŠ”ê°€? ì—ëŸ¬ê°€ ë‚¬ì„ ë•Œ ì˜¬ë°”ë¥´ê²Œ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë°˜í™˜í•˜ëŠ”ê°€? ë“±ê³¼ ê°™ì´ ì˜ˆìƒë˜ëŠ” ê²°ê³¼ ê°’ì„ í‘œí˜„í•œë‹¤. `expect_`ë¡œ ì‹œì‘ë˜ëŠ” í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•œë‹¤.
- **test**ëŠ” ì—¬ëŸ¬ ê°œì˜ expectationë“¤ì„ í•˜ë‚˜ì˜ í•¨ìˆ˜ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ ë‹¨ìœ„ë¡œ ë¬¶ëŠ”ë‹¤. í•¨ìˆ˜ì— ì ìš©í•  ìˆ˜ ìˆëŠ” ì—¬ëŸ¬ê°€ì§€ ë‹¤ì–‘í•œ parameter ìƒí™©ì— ëŒ€í•´ ì¼ê´„ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œí–‰í•œë‹¤. ì´ë ‡ê²Œ í•œ ê¸°ëŠ¥ì— ëŒ€í•´ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ê¸° ë•Œë¬¸ì—, **unit**ì´ë¼ê³  ë¶€ë¥´ê¸°ë„ í•œë‹¤. í…ŒìŠ¤íŠ¸ëŠ” `test_that` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ë§Œë“¤ ìˆ˜ ìˆë‹¤.
- **file**ì€ ì—°ê´€ìˆëŠ” ì—¬ëŸ¬ testë“¤ì„ ëª¨ì•„ ë†“ì€ ê²ƒì´ë‹¤. `context()` í•¨ìˆ˜ë¡œ ì‚¬ëŒì´ ì½ì„ ìˆ˜ ìˆë„ë¡ ì´ë¦„ì„ ë¶™ì—¬ì¤€ë‹¤.

### Expectations
- `expect_`ë¡œ ì‹œì‘í•œë‹¤.
- ë‘ê°œì˜ ì¸ìë¥¼ ê°€ì§„ë‹¤. ì²«ë²ˆì§¸ ì¸ìëŠ” ì‹¤ì œ ê²°ê³¼ê°’, ë‘ë²ˆì§¸ ì¸ìëŠ” ì˜ˆìƒë˜ëŠ” ê²°ê³¼ê°’ì´ë‹¤.
- ë§Œì•½ ì‹¤ì œ ê²°ê³¼ì™€ ì˜ˆìƒë˜ëŠ” ê²°ê³¼ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´, testthatì€ ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¨ë‹¤.

ë¹ˆë²ˆí•˜ê²Œ ì‚¬ìš©ë˜ëŠ” `expect_` í•¨ìˆ˜ë“¤ì„ ì•Œì•„ë³´ì.
- equalityë¥¼ íŒë‹¨í•  ë•Œì—ëŠ” `expect_equal()`ì´ë‚˜ `expect_identical()`ì„ ì‚¬ìš©í•œë‹¤. `equal()` í•¨ìˆ˜ëŠ” ë‹¨ìˆœ ê°’ì˜ ë™ì¼í•¨ ì—¬ë¶€ë§Œ íŒë‹¨í•˜ê³ , `identical()`ì€ ê°’ë¿ë§Œ ì•„ë‹ˆë¼, í´ë˜ìŠ¤ê¹Œì§€ ê°™ì•„ì•¼ í•œë‹¤.(`identical()`ì´ í›¨ì”¬ ê¹Œë‹¤ë¡­ê²Œ íŒë‹¨í•˜ëŠ” ê²ƒì´ë‹¤.)
- `expect_match()`ëŠ” ì •ê·œ í‘œí˜„ì‹ì„ ì´ìš©í•´ ë¬¸ìì—´ì˜ ë§¤ì¹­ ì—¬ë¶€ë¥¼ íŒë‹¨í•´ì¤€ë‹¤. (`all`, `ignore.case = TRUE`, `fixed = TRUE` ë“±ì˜ ì˜µì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.)
- `expect_match()`ì—ì„œ íŒŒìƒëœ ë„¤ ê°€ì§€ í•¨ìˆ˜ê°€ ìˆë‹¤. 
  - `expect_output()`: about printed output
  - `expect_message()`: about message
  - `expect_warning()`: about warning
  - `expect_error()`: about error
- ì›í•˜ëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” í•¨ìˆ˜ê°€ ì—†ë‹¤ë©´ `expect_true()`, `expect_false()`ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

## Writing tests
ê° í…ŒìŠ¤íŠ¸ëŠ” ë°˜ë“œì‹œ ì˜ë¯¸ìˆëŠ” ì´ë¦„ì´ ìˆì–´ì•¼ í•˜ê³ , í•œ ë‹¨ìœ„ì˜ ê¸°ëŠ¥ì„ ë‹¤ë£¨ì–´ì•¼ í•œë‹¤. ê·¸ë˜ì•¼ í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í–ˆì„ ë•Œ, ë¬´ì—‡ì´ ë¬¸ì œì´ë©° ì½”ë“œì˜ ì–´ëŠ ê³³ì„ ë³´ì•„ì•¼ í•˜ëŠ”ì§€ ë¹ ë¥´ê²Œ íŒŒì•…í•  ìˆ˜ ìˆë‹¤. í•œ í…ŒìŠ¤íŠ¸ì— ë„ˆë¬´ ë§ì€ expectationsë¥¼ ë„£ëŠ” ê²ƒì€ í”¼í•˜ì.

### What to test
í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•  ë• ë°¸ëŸ°ìŠ¤ ê²Œì„ì„ í•´ì•¼í•œë‹¤. í…ŒìŠ¤íŠ¸ëŠ” ë¶€ì£¼ì˜í•˜ê²Œ ì½”ë“œë¥¼ ë°”ê¿€ ê°€ëŠ¥ì„±ì„ ë‚®ì¶°ì£¼ì§€ë§Œ, ëª©ì ì— ë§ê²Œ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ëŠ” ê²ƒë„ ì–´ë µê²Œí•œë‹¤. ë‹¤ìŒ í¬ì¸íŠ¸ë“¤ì´ ë„ì›€ì´ ë  ê²ƒì´ë‹¤.
- í•¨ìˆ˜ì˜ external interfaceë¥¼ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê²ƒì— ì§‘ì¤‘í•˜ë¼. ë­”ì†Œë¦¬ì—¬.
- í•˜ë‚˜ì˜ í–‰ë™ì„ ì˜¤ì§ í•˜ë‚˜ì˜ í…ŒìŠ¤íŠ¸ì—ì„œ í…ŒìŠ¤íŠ¸í•˜ë„ë¡ í•´ë¼. ê·¸ëŸ¬ë©´ ë‚˜ì¤‘ì— í•˜ë‚˜ì˜ í–‰ìœ„ì— ëŒ€í•´ ì½”ë“œë¥¼ ë°”ê¿¨ì„ ë•Œ, í•˜ë‚˜ì˜ í…ŒìŠ¤íŠ¸ë§Œ ìˆ˜ì •í•˜ë©´ ëœë‹¤.
- ì‘ë™í• ê±°ë¼ê³  í™•ì‹ í•˜ëŠ” ê°„ë‹¨í•œ ì½”ë“œì— ëŒ€í•´ì„  êµ³ì´ í…ŒìŠ¤íŠ¸í•˜ì§€ ë§ì•„ë¼.
- ë²„ê·¸ë¥¼ ë°œê²¬í•˜ë©´ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ëŠ” ìŠµê´€ì„ ë“¤ì—¬ë¼. test-first ë§ˆì¸ë“œë¥¼ íƒ‘ì¬í•˜ë©´ ì•„ì£¼ ì¢‹ë‹¤. í•­ìƒ í…ŒìŠ¤íŠ¸ë¥¼ ë¨¼ì € ì‘ì„±í•˜ê³ , í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í•˜ë„ë¡ ì½”ë“œë¥¼ ì§œëŠ” ìŠµê´€ì„ ë“¤ì´ëŠ” ê²ƒì´ë‹¤.

### Building your own testing tools

ì•„ë˜ì˜ í…ŒìŠ¤íŠ¸ ì½”ë“œì—” ì¤‘ë³µì´ ë§ì•„ ê°€ë…ì„±ê³¼ ê´€ë¦¬ì˜ ìš©ì´ì„±ì´ ë§ì´ ë–¨ì–´ì§„ë‹¤. ì¤‘ë³µë˜ëŠ” í–‰ìœ„ë“¤ì„ ë½‘ì•„ë‚´ì–´ ìƒˆë¡œìš´ í•¨ìˆ˜ë¡œ ë§Œë“¤ì–´ë²„ë¦¬ë©´ ì¤‘ë³µì„ ì¤„ì¼ ìˆ˜ ìˆë‹¤.

```r
library(lubridate)
#> 
#> Attaching package: 'lubridate'
#> The following objects are masked from 'package:base':
#> 
#>     date, intersect, setdiff, union
test_that("floor_date works for different units", {
  base <- as.POSIXct("2009-08-03 12:01:59.23", tz = "UTC")

  expect_equal(floor_date(base, "second"), 
    as.POSIXct("2009-08-03 12:01:59", tz = "UTC"))
  expect_equal(floor_date(base, "minute"), 
    as.POSIXct("2009-08-03 12:01:00", tz = "UTC"))
  expect_equal(floor_date(base, "hour"),   
    as.POSIXct("2009-08-03 12:00:00", tz = "UTC"))
  expect_equal(floor_date(base, "day"),    
    as.POSIXct("2009-08-03 00:00:00", tz = "UTC"))
  expect_equal(floor_date(base, "week"),   
    as.POSIXct("2009-08-02 00:00:00", tz = "UTC"))
  expect_equal(floor_date(base, "month"),  
    as.POSIXct("2009-08-01 00:00:00", tz = "UTC"))
  expect_equal(floor_date(base, "year"),   
    as.POSIXct("2009-01-01 00:00:00", tz = "UTC"))
})
#> Test passed ğŸ¥‡
```

ì´ì œ ì‹¤ì œê°’ê³¼ ì˜ˆìƒê°’ì´ í•œ ì¤„ì— ë”± ë“¤ì–´ê°€ê¸° ë•Œë¬¸ì— ë¹„êµí•˜ê¸° ì‰¬ì›Œì¡Œë‹¤.

```r
test_that("floor_date works for different units", {
  base <- as.POSIXct("2009-08-03 12:01:59.23", tz = "UTC")
  floor_base <- function(unit) floor_date(base, unit)
  as_time <- function(x) as.POSIXct(x, tz = "UTC")

  expect_equal(floor_base("second"), as_time("2009-08-03 12:01:59"))
  expect_equal(floor_base("minute"), as_time("2009-08-03 12:01:00"))
  expect_equal(floor_base("hour"),   as_time("2009-08-03 12:00:00"))
  expect_equal(floor_base("day"),    as_time("2009-08-03 00:00:00"))
  expect_equal(floor_base("week"),   as_time("2009-08-02 00:00:00"))
  expect_equal(floor_base("month"),  as_time("2009-08-01 00:00:00"))
  expect_equal(floor_base("year"),   as_time("2009-01-01 00:00:00"))
})
#> Test passed ğŸ¥³
```

non-standard evaluationì„ ì´ìš©í•˜ë©´ ë”ìš± ê°„ì†Œí™”í•  ìˆ˜ ìˆë‹¤.

```r
test_that("floor_date works for different units", {
  as_time <- function(x) as.POSIXct(x, tz = "UTC")
  expect_floor_equal <- function(unit, time) {
    eval(bquote(expect_equal(floor_date(base, .(unit)), as_time(.(time)))))
  }

  base <- as_time("2009-08-03 12:01:59.23")
  expect_floor_equal("second", "2009-08-03 12:01:59")
  expect_floor_equal("minute", "2009-08-03 12:01:00")
  expect_floor_equal("hour",   "2009-08-03 12:00:00")
  expect_floor_equal("day",    "2009-08-03 00:00:00")
  expect_floor_equal("week",   "2009-08-02 00:00:00")
  expect_floor_equal("month",  "2009-08-01 00:00:00")
  expect_floor_equal("year",   "2009-01-01 00:00:00")
})
#> Test passed ğŸŠ
```

ì´ë ‡ê²Œ `testthat` íŒ¨í‚¤ì§€ë¥¼ ì´ìš©í•´ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ êµ¬ì„±í•˜ëŠ” ë²•ì„ ê°€ë³ê²Œ ì •ë¦¬í•´ë³´ì•˜ë‹¤. ëŒ€ì¶© ì–´ë–»ê²Œ ì“°ëŠ”ì§€ëŠ” ì•Œì•˜ì§€ë§Œ, ì‹¤ì œë¡œ ì•„ì§ ì‚¬ìš©í•´ë³´ì§€ ëª»í•´ ê°ì´ ì¡íˆì§„ ì•ŠëŠ”ë‹¤. ì¢€ ë” ì‹¤ì œì ì¸ ì ìš© ì‚¬ë¡€ë¥¼ ì•Œì•„ë³´ê¸° ìœ„í•´ ì£¼ìš” íŒ¨í‚¤ì§€ë“¤ì˜ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ëœ¯ì–´ë³´ëŠ” ê²ƒë„ ì¢‹ì€ ê³µë¶€ê°€ ë  ê²ƒ ê°™ë‹¤.